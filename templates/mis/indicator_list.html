{% extends 'base.html' %}
{% load static %}
{% block contents %}
<div class="row align-items-center">
    <div class="col-xl-12 mx-auto">
        <div class="card">
            <div class="card-body">
                <form method='POST' class="needs-validation" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}
                    
                    {% if programe_category %}
                    <h5>Program Data</h5>
                        {% for data in programe_category %}
                        <div class="table-responsive">
                            <h5> {{data.name}} </h5>
                            <table class="table table-hover a" id="hospital_report">
                                <thead >
                                    <tr><th>Indicator</th>
                                        <th>Indicator Type</th> 
                                        <th>Total </th>
                                        <th>Adult Male</th>
                                        <th>Adult Female</th>
                                        <th>Adult Transgender</th>
                                        <th>Child Male</th>
                                        <th>Child Female</th>
                                        <th>Child Transgender</th>
                                    </tr>
                                </thead>
                                    {% for sub_category in data.sub_category %}
                                    <tbody>
                                        <td>{{sub_category.name}}</td> 
                                        <td>{{sub_category.get_indicator_type_display}}</td> 
                                        <td>
                                            <input type="number"  name="total_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Total value</div>
                                        </td> 
                                        <td><input type="number"  name="adult_male_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="" >
                                            <div class="invalid-feedback">Please enter the Adult Male value</div>
                                        </td>
                                        <td>
                                            <input type="number"  name="adult_female_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Adult Female value</div>
                                        </td>
                                        <td>
                                            <input type="number"  name="adult_transgender_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Adult Transgender_ value</div>
                                        </td>
                                        <td>
                                            <input type="number"  name="child_male_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Target value</div>
                                        </td>
                                        <td>
                                            <input type="number"  name="child_female_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Target value</div>
                                        </td>
                                        <td>
                                            <input type="number"  name="child_transgender_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Target value</div>
                                        </td>
                                    </tbody>   
                                    {% endfor %} 
                            </table>
                        </div>
                        {% endfor %} 
                    {% endif %}

                    {% if finance_category %}
                    <h5>Finance Data</h5>
                        {% for fin_data in finance_category %}

                        <div class="table-responsive">
                            <h5> {{fin_data.name}} </h5>
                            <table class="table table-hover a" id="hospital_report">
                                <thead>
                                    <tr><th>Indicator</th>
                                        <th>Indicator Type</th> 
                                        <th>Actual</th>
                                    </tr>
                                </thead>
                                    {% for sub_category in fin_data.sub_category %}
                                    <tbody>
                                        <td>{{sub_category.name}}</td> 
                                        <td>{{sub_category.get_indicator_type_display}}</td> 
                                        <td>
                                            <input type="number"  name="actual_{{sub_category.id}}" value="" class="form-control input_style qty" maxlength="5" required="">
                                            <div class="invalid-feedback">Please enter the Total value</div>
                                        </td> 
                                    </tbody>   
                                    {% endfor %} 
                            </table>
                        </div>
                        {% endfor %} 
                    {% endif %}

                    <div class="modal-footer">

                            {%  if 'Partner Data Entry Operator' == user_role %}
                                {% if task_obj.task_status == 1 or task_obj.task_status == 4 %}
                                <button type="submit" class="btn btn-primary  ml-2">Save</button>
                                <button type="submit" value="{{task_id}}" class="confirm_btn btn btn-info ml-2" onclick="Confirm('{{task_id}}',2,'Submit for Approval')" >
                                    Submit for Approval
                                </button>
                                <button type="reset" onclick="location.href='/task-list/'" class="btn btn-secondary waves-effect">Cancel</button>
                                {% endif %}
                            {%  elif 'Partner Admin' == user_role %}

                                {% if task_obj.task_status == 2 %}
                                <button type="submit" value="{{task_id}}" class="confirm_btn btn btn-info ml-2" onclick="Confirm('{{task_id}}',3,'Approve')" >    
                                    Approve
                                </button>
                                <button type="submit" value="{{task_id}}" class="confirm_btn btn btn-info ml-2" onclick="Confirm('{{task_id}}',4,'Reject')" >
                                    Reject
                                </button>
                                <button type="reset" onclick="location.href='/task-list/'" class="btn btn-secondary waves-effect">Cancel</button>
                                {% endif %}

                            {% endif %}

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/static/app-assets/vendors/js/extensions/sweetalert2.all.min.js"></script>
    <script src="/static/app-assets/js/scripts/extensions/ext-component-sweet-alerts.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script>
        function Confirm(task_id,val,title){
            Swal.fire({
            title: 'Are you sure you want to '+ title +' ?',
            showCancelButton: true,
            confirmButtonText: 'Yes',
            }).then((result) => {
            /* Read more about isConfirmed, isDenied below */
            if (result.isConfirmed){
                $.ajax({
                url: "/ajax-task/"+task_id,
                type:'POST',
                data:{status_val:val}, 
                dataType: 'json',
                success: function(result) {
                    // window.location.reload();
                } 
            });
            }
        }).then(function(){ window.location.reload() })
        }
    </script>

{% endblock %}