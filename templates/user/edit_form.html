{% extends 'base.html' %}
{% load static %}

{% block contents %}
<style>
    .error{
        color: red;
        list-style: none;
        display: contents;
        
    }
    .errorlist li::marker{
        display: none!important;
    }
    .errorlist  li{
        list-style: none;
    }
    .errorlist{
        padding: 0px!important;
    }
</style>
<div class="row align-items-center">
    <div class="col-xl-12 mx-auto">
        <div class="card">
            <div class="card-body">
              
                <form method='POST' enctype="multipart/form-data" class="needs-validation" autocomplete="off" novalidate>
                  {% csrf_token %}
                  {% if error %}
                  <div class="error">
                    {{ error }}
                    {{error_messages}}
                  </div>
                  {% endif %}
                  <div class="row "> 
                    {% for field in forms %}
                    <label for="" class="col-md-2 col-form-label mb-4" >
                        {% if field.field.required %}
                        {{field.label}}<span class="required-field"></span>
                        {% else %}
                        {{field.label}}
                        {% endif %}
                    </label>
                    <div class="col-md-4">
                        {{field}}
                        {% if field.errors %}
                          <div class="invalid-feedback">
                            {{ field.errors.0 }}
                          </div>
                        {% endif %}
                        {% if field.field.widget.input_type == 'select' %} 
                        <div class="invalid-feedback">
                          Please Choose {{field.label}} 
                        </div>
                        {% else %}
                        <div class="invalid-feedback" id="char_field" >
                          Please Enter {{field.label}}
                        </div>
                        {%  endif %}
                    </div>
                    {% endfor %}
                  </div>

                  <div class="mt-3">
                    <button type="reset" onclick="window.location.href='/application_master/list/{{model}}/'" class="btn btn-secondary waves-effect">
                        Cancel
                    </button>
                    <button type="submit" id="submitting" class="btn btn-primary w-md">Save</button>
                  </div>
                </form>
            </div>
            <!-- end card body -->
        </div>
        <!-- end card -->
    </div>
</div>
<script src="{% static 'libs/jquery/dist/jquery.min.js' %}"></script>
<script src="{% static 'js/pages/form-validation.init.js' %}"></script> 

<script>
  $(document).ready(function() {
      $('select').addClass('form-control');
      $('input').addClass('form-control');

      $('#id_state').change(function() {
          var stateId = $(this).val();
          console.log('State ID selected:', stateId); // Debug statement
          
          if (stateId === "") {
              $('#id_district').prop('readonly', true);
              $("#id_district option").remove();
          } else {
              $.ajax({
                  type: "GET",
                  url: '/ajax/district/' + stateId + '/',
                  success: function(result) {
                      console.log('Result received:', result); // Debug statement
                      var districtSelect = $('#id_district');
                      districtSelect.empty();
                      districtSelect.append('<option value="">Select District</option>');
                      result.forEach(function(district) {
                          districtSelect.append('<option value="' + district.id + '">' + district.name + '</option>');
                      });
                  },
                  error: function(xhr, status, error) {
                      console.error('Error occurred:', status, error); // Debug statement
                  }
              });
          }
      });
  });
</script>

{% endblock %}